(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(t){if(t.ep)return;t.ep=!0;const l=o(t);fetch(t.href,l)}})();const ee=(e,n,o,a=5,t="black",l="black")=>{e.beginPath(),e.arc(n,o,a,0,Math.PI*2,!1),e.fillStyle=l,e.fill(),e.strokeStyle=t,e.stroke()};function te(e,n=[],o=0,a=0,t=1,l){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.save(),e.translate(o,a),e.scale(t,t),e.drawImage(l,0,0,2048,2048);const s=1152,f=1052,y=25,F=2;e.beginPath(),e.strokeStyle="green",e.lineWidth=F,e.moveTo(s-y/2,f),e.lineTo(s+y/2,f),e.moveTo(s,f-y/2),e.lineTo(s,f+y/2),e.stroke();for(const S of n)ee(e,S.x,S.y,S.radius,S.colorStroke,S.colorFill);e.beginPath(),e.arc(0,0,5,0,Math.PI*2,!1),e.fillStyle="red",e.fill(),e.stroke(),e.restore(),e.fillStyle="black",e.font="16px Inter";const R=(-o+e.canvas.width/2)/t,Z=(-a+e.canvas.height/2)/t;e.fillText(`World Viewport Top-Left: X=${R.toFixed(0)}, Y=${Z.toFixed(0)}, Zoom=${t.toFixed(2)}x`,10,20),e.beginPath(),e.arc(e.canvas.width/2,e.canvas.height/2,2,0,Math.PI*2,!1),e.fillStyle="blue",e.fill(),e.stroke()}const ne=(e,n,o,a,t,l=2048,s=2048)=>{let f=o/t,y=s-a/t,F=e/t+f,R=n*-1/t+y;return[F,R]},I=(e,n,o=5,a,t)=>({x:e,y:n,radius:o,colorStroke:a,colorFill:t});let h=100,v=100,u=null,T=null;const D=document.getElementById("debugX"),_=document.getElementById("debugY"),G=document.getElementById("debugXValue"),O=document.getElementById("debugYValue");function oe(e){T=e,D.addEventListener("input",n=>{h=parseFloat(n.target.value),G.textContent=h,J()}),_.addEventListener("input",n=>{v=parseFloat(n.target.value),O.textContent=v,J()}),D.value=h,_.value=v,G.textContent=h,O.textContent=v,J(),console.log("DEBUG.JS: Initialized with drawQueue. Length:",T.length)}function J(){if(!T){console.error("DEBUG.JS: _mainGameDrawQueue not initialized!");return}u?(u.x=h,u.y=v,console.log("DEBUG.JS: Updated existing debug object position to:",u.x,u.y)):(u=I(h,v,15,"lime","darkgreen"),T.push(u),console.log("DEBUG.JS: Created and pushed new debug object. Queue length:",T.length))}let Y=new Map,B=null,E=null;const ae=e=>(console.log("REPLAY_MANAGER.JS: ",e),le(e),re(e),console.log("min max",B,E),console.log(Y),!0),le=e=>{B=e[0].get("tick"),E=e[e.length-1].get("tick")},re=e=>{console.log("REPLAY_MANAGER.JS: Constructing Map");let n=e[0].get("tick"),o=e[0].get("tick"),a=[];for(let t=0;t<e.length;t++)n=e[t].get("tick"),n===o?a.push({X:e[t].get("X"),Y:e[t].get("Y"),name:e[t].get("name"),sid:e[t].get("steamid")}):(Y.set(o,structuredClone(a)),o=n,a=[],a.push({X:e[t].get("X"),Y:e[t].get("Y"),name:e[t].get("name"),sid:e[t].get("steamid")}));Y.set(n,structuredClone(a)),console.log(`Replay data processed. Min Tick: ${B}, Max Tick: ${E}`)},A=()=>B||0,L=()=>E||0;console.log(E,B);const se=e=>e>E?[]:Y.get(Math.floor(e))||[];async function ie(){const e=wasm_bindgen;if(typeof e>"u")throw console.error("Error: `wasm_bindgen` is not defined globally. Ensure `/pkg/demoparser2.js` is loaded via a non-module <script> tag before this module."),new Error("WASM glue code not found.");try{await e("/cs2demoview/pkg/demoparser2_bg.wasm"),console.log("WASM.JS: Main thread WASM binary loaded successfully.")}catch(n){throw console.error("Failed to load WASM binary in main thread:",n),n}}await new Promise((e,n)=>{const o=document.createElement("script");o.src="/cs2demoview/pkg/demoparser2.js",o.onload=e,o.onerror=n,document.head.appendChild(o)});await wasm_bindgen("/cs2demoview/pkg/demoparser2_bg.wasm");console.log("WASM module initialized");console.log("MAIN.JS: Attempting to create new Worker with path:");const x=new Worker(new URL("/cs2demoview/assets/worker-CyKDDEJJ.js",import.meta.url),{type:"classic"});console.log("MAIN.JS: Worker constructor called.");const de=document.getElementById("demoFileInput"),z=document.getElementById("loadingIndicator");let i=1,g=!1,c=1;const U=64;let C=0;const W=[I(300,300,20,"red","darkred"),I(1500,500,25,"blue","darkblue"),I(800,1800,30,"purple","darkpurple")];console.log("MAIN.JS: Static mainGameDrawQueue initialized. Length:",W.length);oe(W);de.addEventListener("change",async e=>{const n=e.target.files[0];if(!n)return;z.style.display="block",g=!1,P.textContent="Play";const o=new FileReader;o.onload=async a=>{const t=new Uint8Array(a.target.result);console.log("MAIN.JS: Sending demo file to worker for parsing..."),x.postMessage({fileBytes:t,fieldsToExtract:["X","Y"]})},o.readAsArrayBuffer(n)});x.onmessage=e=>{const n=e.data;console.log("MAIN.JS: Received parsed data from worker:",n),ae(n),i=A(),M.min=A(),M.max=L(),ye.textContent=L(),ve.textContent=K(L()),M.value=i,V(),console.log("MAIN.JS: Replay data successfully loaded into manager."),z.style.display="none"};x.onerror=function(e){console.error("MAIN.JS: Worker error:",e)};const r=document.querySelector("canvas"),ce=r.getContext("2d"),j=document.getElementById("canvas-container");function Q(){r.width=j.offsetWidth,r.height=j.offsetHeight,console.log(`Canvas resized to: ${r.width}x${r.height} (matching parent div)`)}Q();let m=r.width/2,p=r.height/2,d=1,b=!1,w,k,$=new Image;$.src="/cs2demoview/maps/de_train/radar.png";$.onload=()=>{console.log("MAIN.JS: Map image loaded.")};const ue=document.getElementById("translateX"),ge=document.getElementById("translateY"),X=document.getElementById("scaleFactor"),me=document.getElementById("translateXValue"),pe=document.getElementById("translateYValue"),q=document.getElementById("scaleFactorValue"),M=document.getElementById("replaySlider"),fe=document.getElementById("currentTick"),ye=document.getElementById("maxTick"),he=document.getElementById("currentTickTime"),ve=document.getElementById("maxTickTime"),P=document.getElementById("playPauseBtn"),we=document.getElementById("speedUpBtn"),ke=document.getElementById("slowDownBtn"),N=document.getElementById("playbackSpeed");X.addEventListener("input",e=>{d=parseFloat(e.target.value),q.textContent=d.toFixed(2)});window.addEventListener("resize",Q);r.addEventListener("mousedown",e=>{b=!0,r.classList.add("grabbing"),w=e.clientX,k=e.clientY});r.addEventListener("mousemove",e=>{if(b){const n=e.clientX-w,o=e.clientY-k;m+=n,p+=o,w=e.clientX,k=e.clientY}});r.addEventListener("mouseup",()=>{b=!1,r.classList.remove("grabbing")});r.addEventListener("touchstart",e=>{e.preventDefault(),b=!0,r.classList.add("grabbing"),w=e.touches[0].clientX,k=e.touches[0].clientY});r.addEventListener("touchmove",e=>{if(b){e.preventDefault();const n=e.touches[0].clientX-w,o=e.touches[0].clientY-k;m+=n,p+=o,w=e.touches[0].clientX,k=e.touches[0].clientY}});r.addEventListener("touchend",()=>{b=!1,r.classList.remove("grabbing")});X.addEventListener("input",e=>{d=parseFloat(e.target.value)});r.addEventListener("wheel",e=>{e.preventDefault();const n=.1,o=e.clientX-r.getBoundingClientRect().left,a=e.clientY-r.getBoundingClientRect().top,t=(o-m)/d,l=(a-p)/d;let s=d;e.deltaY<0?s+=n:s-=n,s=Math.max(.05,Math.min(s,5)),m=o-t*s,p=a-l*s,d=s,X.value=s});M.addEventListener("input",e=>{i=parseInt(e.target.value,10),g=!1,V()});P.addEventListener("click",()=>{g=!g,P.textContent=g?"Pause":"Play"});we.addEventListener("click",()=>{c=Math.min(c*2,8),N.textContent=`${c}x`});ke.addEventListener("click",()=>{c=Math.max(c/2,.25),N.textContent=`${c}x`});function K(e){let n=Math.floor(e/U),o=n%60,a=Math.floor(n%3600/60),t=Math.floor(n/3600);return String(t).padStart(2,"0")+":"+String(a).padStart(2,"0")+":"+String(o).padStart(2,"0")}function V(){fe.textContent=i.toFixed(2),he.textContent=K(i),M.value=i}function H(e){C||(C=e);const n=e-C;if(C=e,g){const t=n/1e3*U*c;i+=t;const l=L();i>l?(i=l,g=!1,P.textContent="Play"):i<A()&&(i=A()),V()}const o=se(i),a=[...W];o.forEach(t=>{let l=ne(t.X,t.Y,2730,2360,2.37,2048,2048);a.push(I(l[0],l[1],10,"yellow","orange"))}),te(ce,a,m,p,d,$),requestAnimationFrame(H)}async function Ee(){await ie(),console.warn("Could not load default lowtick.json. Waiting for user upload."),requestAnimationFrame(H)}ue.value=m;ge.value=p;X.value=d;me.textContent=m;pe.textContent=p;q.textContent=d.toFixed(2);N.textContent=`${c}x`;Ee();
